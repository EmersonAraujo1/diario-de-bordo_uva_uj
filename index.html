<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Diário de Bordo - Corporativo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* ... Seu CSS anterior permanece inalterado ... */
  </style>
</head>
<body>
  <!-- ... Seu HTML permanece inalterado (header, nav, views, etc.) ... -->

  <script>
    const GOOGLE_SHEET_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyaUlvGoiPbYjrfoPHarYnEV4fcx2gzeE-v3cbESxowFXo1V93gBBnp_RUr_Y7M8Zqg/exec"; // Substitua pelo seu URL
    const senhaCorreta = "admin123";

    function toggleView(viewId) {
      document.getElementById('formView').style.display = 'none';
      document.getElementById('adminView').style.display = 'none';
      document.getElementById('senhaAdmin').style.display = 'none';
      document.getElementById(viewId).style.display = 'flex';
    }

    function mostrarCampoSenha() {
      toggleView('senhaAdmin');
    }

    function validarSenha() {
      const senha = document.getElementById("senha").value;
      if (senha === senhaCorreta) {
        toggleView('adminView');
        atualizarTabela();
      } else {
        alert("Senha incorreta.");
      }
    }

    async function carregarChamados() {
      try {
        const response = await fetch(GOOGLE_SHEET_WEBAPP_URL);
        const chamados = await response.json();
        return chamados;
      } catch (err) {
        console.error("Erro ao carregar chamados:", err);
        return [];
      }
    }

    async function adicionarChamadoExterno(chamado) {
      try {
        await fetch(GOOGLE_SHEET_WEBAPP_URL, {
          method: "POST",
          body: JSON.stringify(chamado),
          headers: {
            "Content-Type": "application/json",
          },
        });
        atualizarTabela();
      } catch (err) {
        console.error("Erro ao adicionar chamado:", err);
      }
    }

    async function enviarFormulario() {
      const nome = document.getElementById("nome").value.trim();
      const cargo = document.getElementById("cargo").value;
      const plataforma = document.getElementById("plataforma").value;
      const motivo = document.getElementById("motivo").value;
      const obs = document.getElementById("obs").value.trim();

      if (!nome) {
        alert("Por favor, preencha o nome.");
        return;
      }

      const dataAtual = new Date();
      const data = dataAtual.toLocaleDateString("pt-BR");
      const hora = dataAtual.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" });

      const registro = {
        nome,
        cargo,
        plataforma,
        motivo,
        obs,
        data,
        hora,
        status: "Pendente"
      };

      await adicionarChamadoExterno(registro);

      document.querySelectorAll('#formView input[type=text], #formView textarea').forEach(el => el.value = '');
      document.getElementById("notificacao").textContent = "✅ Chamado registrado com sucesso!";
      setTimeout(() => document.getElementById("notificacao").textContent = "", 4000);
    }

    async function atualizarTabela() {
      const chamados = await carregarChamados();
      const filtroStatus = document.getElementById("filtroStatus").value;
      const filtroPlataforma = document.getElementById("filtroPlataforma").value;
      const buscaNome = document.getElementById("buscaNome").value.toLowerCase();
      const tbody = document.querySelector("#tabelaChamados tbody");

      tbody.innerHTML = "";

      chamados.forEach((c, i) => {
        if (filtroStatus !== "Todos" && c.status !== filtroStatus) return;
        if (filtroPlataforma !== "Todas" && c.plataforma !== filtroPlataforma) return;
        if (buscaNome && !c.nome.toLowerCase().includes(buscaNome)) return;

        const tr = document.createElement("tr");
        tr.className = c.status === "Pendente" ? "pendente" : c.status === "Em tratativa" ? "tratativa" : "resolvido";

        tr.innerHTML = `
          <td>${c.nome}</td>
          <td>${c.cargo}</td>
          <td>${c.plataforma}</td>
          <td>${c.motivo}</td>
          <td>${c.observações || c.obs}</td>
          <td>${c.data}</td>
          <td>${c.hora}</td>
          <td>${c.status}</td>
          <td>
            <button class="btn-table" disabled>Em tratativa</button>
            <button class="btn-table" disabled>Resolvido</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    toggleView('formView');
  </script>
</body>
</html>
