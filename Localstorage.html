<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Di√°rio de Bordo - Corporativo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* (mant√©m todo o seu CSS original aqui) */
  </style>
</head>
<body>
  <!-- (mant√©m todo o seu HTML original at√© o final do body) -->

  <script>
    let chamados = [];
    const senhaCorreta = "admin123";

    function toggleView(viewId) {
      document.getElementById('formView').style.display = 'none';
      document.getElementById('adminView').style.display = 'none';
      document.getElementById('senhaAdmin').style.display = 'none';
      document.getElementById(viewId).style.display = 'flex';
    }

    function mostrarCampoSenha() {
      toggleView('senhaAdmin');
    }

    function validarSenha() {
      const senha = document.getElementById("senha").value;
      if (senha === senhaCorreta) {
        toggleView('adminView');
        atualizarTabela();
      } else {
        alert("Senha incorreta.");
      }
    }

    function enviarFormulario() {
      const nome = document.getElementById("nome").value.trim();
      const cargo = document.getElementById("cargo").value;
      const plataforma = document.getElementById("plataforma").value;
      const motivo = document.getElementById("motivo").value;
      const obs = document.getElementById("obs").value.trim();

      if (!nome) {
        alert("Por favor, preencha o nome.");
        return;
      }

      const dataAtual = new Date();
      const data = dataAtual.toLocaleDateString('pt-BR');
      const hora = dataAtual.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

      const registro = {
        nome,
        cargo,
        plataforma,
        motivo,
        obs,
        data,
        hora,
        status: "Pendente"
      };

      chamados.push(registro);
      salvarLocalStorage();
      atualizarTabela();

      document.querySelectorAll('#formView input, #formView textarea').forEach(el => el.value = '');
      document.getElementById("notificacao").textContent = "‚úÖ Chamado registrado com sucesso!";
      setTimeout(() => document.getElementById("notificacao").textContent = "", 4000);
    }

    function salvarLocalStorage() {
      localStorage.setItem("chamados", JSON.stringify(chamados));
    }

    function carregarLocalStorage() {
      const dadosSalvos = localStorage.getItem("chamados");
      if (dadosSalvos) {
        chamados = JSON.parse(dadosSalvos);
      }
    }

    function marcarTratativa(index) {
      chamados[index].status = "Em tratativa";
      salvarLocalStorage();
      atualizarTabela();
    }

    function resolverChamado(index) {
      chamados[index].status = "Resolvido";
      salvarLocalStorage();
      atualizarTabela();
    }

    function atualizarTabela() {
      const filtroStatus = document.getElementById("filtroStatus")?.value || "Todos";
      const filtroPlataforma = document.getElementById("filtroPlataforma")?.value || "Todas";
      const buscaNome = document.getElementById("buscaNome")?.value.toLowerCase() || "";

      const tbody = document.querySelector("#tabelaChamados tbody");
      tbody.innerHTML = "";

      chamados.forEach((c, i) => {
        if (filtroStatus !== "Todos" && c.status !== filtroStatus) return;
        if (filtroPlataforma !== "Todas" && c.plataforma !== filtroPlataforma) return;
        if (buscaNome && !c.nome.toLowerCase().includes(buscaNome)) return;

        const tr = document.createElement("tr");
        tr.className = c.status === "Pendente" ? "pendente"
          : c.status === "Em tratativa" ? "tratativa"
          : "resolvido";

        tr.innerHTML = `
          <td>${c.nome}</td>
          <td>${c.cargo}</td>
          <td>${c.plataforma}</td>
          <td>${c.motivo}</td>
          <td>${c.obs}</td>
          <td>${c.data}</td>
          <td>${c.hora}</td>
          <td>${c.status}</td>
          <td>
            ${c.status !== "Resolvido" ? `
              <button class="btn-table" onclick="marcarTratativa(${i})">üîß Tratativa</button>
              <button class="btn-table" onclick="resolverChamado(${i})">‚úîÔ∏è Resolver</button>
            ` : '‚Äî'}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function filtrarChamados() {
      atualizarTabela();
    }

    function exportarExcel() {
      const filtroStatus = document.getElementById("filtroStatus")?.value || "Todos";
      const filtroPlataforma = document.getElementById("filtroPlataforma")?.value || "Todas";
      const buscaNome = document.getElementById("buscaNome")?.value.toLowerCase() || "";

      const dadosFiltrados = chamados.filter((c) => {
        if (filtroStatus !== "Todos" && c.status !== filtroStatus) return false;
        if (filtroPlataforma !== "Todas" && c.plataforma !== filtroPlataforma) return false;
        if (buscaNome && !c.nome.toLowerCase().includes(buscaNome)) return false;
        return true;
      });

      if (dadosFiltrados.length === 0) {
        alert("Nenhum registro para exportar.");
        return;
      }

      const ws = XLSX.utils.json_to_sheet(dadosFiltrados);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Chamados");
      XLSX.writeFile(wb, "diario_de_bordo_filtrado.xlsx");
    }

    carregarLocalStorage();
    toggleView('formView');
  </script>
</body>
</html>
